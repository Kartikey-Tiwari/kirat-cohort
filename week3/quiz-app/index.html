<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
    body {
      display: flex;
      min-height: 100dvh;
      background: linear-gradient(180deg, pink 0%, #6200c9 50%, pink 100%);
      align-items: center;
      justify-content: center;
      font-family: monospace;
      margin: 0;
    }
    .quiz-container {
      max-width: 1000px;
      width: 80vw;
      margin: 0 auto;
    }
    .question, .option-wrapper {
      background: #003175;
      border: 2px solid #DDB25C;
      color: white;
      font-size: 1.5rem;
      padding: 10px;
      box-sizing: border-box;
      border-radius: 1.5rem;
      position: relative;
    } 
    .question {
      text-align: center;
      margin: 0;
    }
    .question::before, .question::after,
    .option-wrapper::before, .option-wrapper::after {
      content: "";
      position: absolute;
      width: 2rem;
      height: 3px;
      background: #DDB25C;
      top: 50%;
    }

    .option-wrapper {
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }

    .hidden {
      opacity: 0;
    }

    .option-wrapper.wrong {
      border-color: red;
      outline: none;
    }
    label {
      flex: 1;
      cursor: pointer;
      text-wrap: balance;
    }
    input[type="radio"] {
      cursor: pointer;
    }
    .option-wrapper:nth-child(even)::before {
      z-index: -1;
    }
    .question::before, .option-wrapper::before {
      left: 0;
      transform: translateX(-100%);
    }
    .question::after, .option-wrapper::after {
      right: 0;
      transform: translateX(100%);
    }
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      row-gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .question-timer-wrapper {
      position:relative;
    }

    .timer, .timer-progress {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translate(-50%,-50%);
      border-radius: 50%;
      padding: 1rem 1.5rem 3rem;
      background: linear-gradient(90deg, #003175 0%);
      color: white;
      width: 1rem;
      display: flex;
      justify-content: center;
    }

    .timer-progress {
        padding: 2.8rem 1.8rem;
        background: linear-gradient(90deg, #DDB25C 0%);
    }

    .next-button {
      background: #003175;
      padding: 0.5rem;
      border-radius: 20px;
      color: white;
      border: 2px solid #DDB25C;
      cursor: pointer;
      font-size: 1.2rem;
    }


    .next-button:active:not(:disabled) {
      transform: scale(0.9);
    }

    .selected {
      box-shadow: 5px 8px 15px rgba(0, 0, 0, 0.7);
      outline: 2px solid #DDB25C;
    }

    .question-screen {
      display: grid;
      gap: 1rem;
    }

    progress {
      width: 100%;
    }

    .info-bar {
      color: white;
      display: flex;
      justify-content: space-around;
      font-size: 1rem;
      font-weight: bold;
    }

    h1 {
      text-decoration: underline;
      text-align: center;
      color: white;
      font-size: 3rem;
      margin-top: 0;
      padding-top: 1rem;
    }

    h2 {
      font-size: 2rem;
    }

    .welcome-screen {
      color: white;
      text-align: center;
    }

    .start-quiz-btn, .restart-btn {
      border-radius: 20px;
      border: 2px solid #DDB25C;
      background: #003175;
      color: inherit;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      color: white;
    }

    .restart-btn {
      margin-top: 1rem;
      justify-self: center;
    }

    .welcome-screen p {
      font-size: 1.5rem;
    }

    .final-score {
      text-align: center;
      font-size: 2rem;
      background: #003175;
      border: 3px solid #DDB25C;
      color: white;
      border-radius: 20px;
      padding: 0.5rem 3rem;
    }

    .score-screen {
      display: grid;
    }
    
    .lifeline, .lifeline-container {
      background: #003175;
      border: 3px solid #DDB25C;
      border-radius: 1.5rem;
      display: flex;
      justify-content: center;
      color: white;
      margin: 0 auto;
      gap: 3rem;
      padding: 0.5rem 3rem;
    }

    .lifeline {
      position: relative;
      border-radius: 50%;
      width: 6rem;
      height: 4rem;
      align-items: center;
      font-weight: bold;
      font-size: 1.3rem;
      transition: opacity 0.1s linear;
    }

    .lifeline:hover:not(:disabled) {
      transform: scale(1.05);
    }

    .lifeline:active:not(:disabled) {
      transform: scale(0.9);
    }

    .lifeline:disabled::before {
      content: "❌";
      position: absolute;
      font-size: 3rem;
      opacity: 0.9;
    }

    .next-button:disabled {
      opacity: 0.7;
      color: #666666;
      background-color: #cccccc;
      cursor: not-allowed;
      background: #546e7a; 
      border: 3px solid #8c8c8c; 
      color: #e0e0e0;
    }

    @media (max-width: 768px) {
      .options {
        grid-template-columns: 1fr;
      }

      label {
        font-size: 1rem;
      }

      .option-wrapper::before, .option-wrapper::after, .question::before, .question::after {
        width: 1rem;
      }

      h1 {
        font-size: 2rem;
      }

      h2 {
        font-size: 1.2rem;
      }

      .lifeline-container {
        padding-inline: 1rem;
        gap: 2rem;
        margin-bottom: 1rem;
      }

      .info-bar {
        margin-bottom: 1rem;
      }

      .lifeline {
        height: auto;
      }

      .question {
        font-size: 1.2rem;
      }

      .options {
        margin-bottom: 0;
      }

      .info-bar {
        font-size: 0.8rem;
        justify-content: space-between;
      }

      body:has(> main .question-screen) {
        display: block;
      }
    }
    </style>
  </head>
  <body>
    <main>
      <h1>The Web Dev Quiz</h1>
      <div class="quiz-container">
        <div class="welcome-screen">
          <h2>Welcome to The Web Dev Quiz</h2>
          <p>15 questions to test your mastery </p>
          <button class="start-quiz-btn">Let's start the quiz</button
        </div>
      </div>
    </main>
  </body>
  <script>
    // state
const questions = [{
    "question": "Which language runs in a web browser?",
    "a": "Java",
    "b": "C",
    "c": "Python",
    "d": "JavaScript",
    "correct": "d",
  },
  {
    "question": "What does CSS stand for?",
    "a": "Central Style Sheets",
    "b": "Cascading Style Sheets",
    "c": "Cascading Simple Sheets",
    "d": "Cars SUVs Sailboats",
    "correct": "b",
  },
  {
    "question": "What does HTML stand for?",
    "a": "Hypertext Markup Language",
    "b": "Hypertext Markdown Language",
    "c": "Hyperloop Machine Language",
    "d": "Helicopters Terminals Motorboats Lamborginis",
    "correct": "a",
  },
  {
    "question": "What year was JavaScript launched?",
    "a": "1996",
    "b": "1995",
    "c": "1994",
    "d": "none of the above",
    "correct": "b",
  },
  {
    "question": "Which HTTP method is idempotent and used to *update* an entire resource?",
    "a": "POST",
    "b": "PUT",
    "c": "GET",
    "d": "PATCH",
    "correct": "b",
  },
  {
    "question": "In CSS Flexbox, what does `align-items` control?",
    "a": "Alignment along the main axis",
    "b": "Alignment along the cross axis",
    "c": "The spacing between flex items",
    "d": "The size of flex items",
    "correct": "b",
  },
  {
    "question": "Which of the following CSS selectors has the *highest* specificity?",
    "a": ".container .nav-link",
    "b": "body #main-content",
    "c": "a:hover",
    "d": "div.row > p",
    "correct": "b",
  },
  {
    "question": "What is the value of `this` inside a JavaScript arrow function (=>)?",
    "a": "The global object (window)",
    "b": "The function itself",
    "c": "The `this` of the enclosing lexical scope",
    "d": "undefined",
    "correct": "c",
  },
  {
    "question": "In React, what is the primary way to pass data from a parent to a child component?",
    "a": "state",
    "b": "props",
    "c": "Context API",
    "d": "Redux",
    "correct": "b",
  },
  {
    "question": "What does 'WAI-ARIA' stand for in web accessibility?",
    "a": "Web Accessibility Initiative - Accessible Rich Internet Applications",
    "b": "Web Application Interface - Accessible Responsive Internet Apps",
    "c": "Web Accessibility Integration - Real-time Internet Access",
    "d": "World Accessible Internet - Responsive Integration Architecture",
    "correct": "a",
  },
  {
    "question": "What HTTP status code means 'Not Found'?",
    "a": "200",
    "b": "500",
    "c": "301",
    "d": "404",
    "correct": "d",
  },
  {
    "question": "What keyword is used to pause execution inside an `async` function until a Promise settles?",
    "a": "wait",
    "b": "pause",
    "c": "await",
    "d": "yield",
    "correct": "c",
  },
  {
    "question": "What is the name of the package manager that comes bundled with Node.js?",
    "a": "Yarn",
    "b": "npm",
    "c": "Bower",
    "d": "Webpack",
    "correct": "b",
  },
  {
    "question": "Which HTML5 element is best for wrapping main navigation links?",
    "a": "<div>",
    "b": "<section>",
    "c": "<nav>",
    "d": "<ul>",
    "correct": "c",
  },
  {
    "question": "What is the purpose of the `DOCTYPE` declaration in an HTML file?",
    "a": "It defines the document's character set",
    "b": "It links the CSS stylesheet",
    "c": "It tells the browser which HTML version to use",
    "d": "It loads the JavaScript files",
    "correct": "c",
  }
]
    const secondsPerQs = 10
    const quizTime = questions.length * secondsPerQs;
    let quizTimeRemaining = quizTime;
    let score = 0;
    let quizStart = false;
    let currentQuestion = 0;
    let selectedOption = -1;
    let timerId;

    const tickSound = new Audio("tick.m4a");
    tickSound.volume = 0.3

    function playTick() {
      tickSound.currentTime = 0.3;
      tickSound.play().catch(error => {
        console.log("Audio playback failed:" ,error)
      })
    }

    const quizContainer = document.querySelector(".quiz-container");
    const welcomeScreen = document.querySelector(".welcome-screen");
    const startQuizButton = welcomeScreen.querySelector(".start-quiz-btn")
    startQuizButton.addEventListener("click", () => {
      startQuiz();
    })

    // question screen
    const questionScreen = document.createElement("div");
    questionScreen.classList.add("question-screen");

    const progressBar = document.createElement("progress");
    progressBar.max = questions.length;
    progressBar.value = 0;

    const infoBar = document.createElement("div");
    infoBar.classList.add("info-bar")
    infoBar.insertAdjacentHTML("afterbegin", `<span>Question: <span class="qs-no">1</span>/${questions.length}</span><span>Score: <span class="score">0</span>/${questions.length}</span>`)
    const scoreSpan = infoBar.querySelector(".score")
    const qsNoSpan = infoBar.querySelector(".qs-no")

    const questionWrapper = document.createElement("div");

    const questionTimerWrapper = document.createElement("div")
    questionTimerWrapper.classList.add("question-timer-wrapper")
    const question = document.createElement("h3");
    question.classList.add("question")
    const options = document.createElement("div");
    options.classList.add("options")
    for (let i = 0; i < 4; i++) {
      const optionWrapper = document.createElement("div")
      optionWrapper.classList.add("option-wrapper")
      const option = document.createElement("input");
      optionWrapper.addEventListener("click", () => {
        options.querySelectorAll(".option-wrapper").forEach(oW => oW.classList.remove("selected"))
        optionWrapper.classList.add("selected");
        nextButton.disabled = false;
        selectedOption = i;
        option.click();
      })
      const optionId = `option${i}`
      option.name = "options"
      option.type = "radio"
      option.id = optionId
      const label = document.createElement("label")
      label.htmlFor = optionId
      optionWrapper.append(option, label);
      options.append(optionWrapper);
    }

    const timer = document.createElement("span")
    const timerProgress = document.createElement("span")
    timerProgress.classList.add("timer-progress")
    timer.textContent = `${quizTimeRemaining}`
    timer.classList.add("timer")

    questionTimerWrapper.append(timerProgress, timer, question)

    const nextButton = document.createElement("button");
    nextButton.classList.add("next-button")
    nextButton.disabled = true;
    nextButton.textContent = "Next"

    const lifelinesArray = [{name: "fiftyFifty", used: false, handler: handleFiftyFifty}, {name: "doubleDip", used: false, handler: handleDoubleDip}];
    let curLifeline = null;
    const lifelineContainer = document.createElement("div")
    lifelineContainer.classList.add("lifeline-container")
    const lifelinesHTML = `<button class="lifeline fifty-fifty">50:50</button><button class="lifeline double-dip">x2</button>`
    lifelineContainer.insertAdjacentHTML("afterbegin", lifelinesHTML)
    const fiftyFifty = lifelineContainer.querySelector(".fifty-fifty")
    fiftyFifty.addEventListener("click", () => handleLifeline("fiftyFifty"));
    const doubleDip = lifelineContainer.querySelector(".double-dip")
    doubleDip.addEventListener("click", () => handleLifeline("doubleDip"))
    
    questionScreen.append(progressBar, infoBar, questionTimerWrapper, options,  nextButton, lifelineContainer)
    
    // quiz end screen
    const quizEndScreen = document.createElement("div")
    quizEndScreen.classList.add("score-screen")
    const scoreElement = document.createElement("div")
    scoreElement.classList.add("final-score")
    const restartQuizBtn = document.createElement("button");
    restartQuizBtn.classList.add("restart-btn")
    restartQuizBtn.textContent = "Restart Quiz"
    restartQuizBtn.addEventListener("click", restartQuiz)
    quizEndScreen.append(scoreElement, restartQuizBtn);

    nextButton.addEventListener("click", () => {
      if (selectedOption === -1) return;
      if (isSelectedOptionCorrect()) {
        fiftyFifty.classList.remove("hidden");
        score++;
      } else {
        if (curLifeline && curLifeline.name === "doubleDip") {
          dipsLeft--;
          if (dipsLeft !== 0) {
            const ow = options.children[selectedOption];
            ow.classList.add("wrong")
            ow.firstElementChild.disabled = true;
            return
          }
          else {
            fiftyFifty.classList.remove("hidden");
          }
        }
      } 
      if (currentQuestion === questions.length - 1) {
        endQuiz()
        return;
      }
      currentQuestion++;
      selectedOption = -1;
      curLifeline = null;
      updateQuestionScreen()
    })

    function getQuizResult(correctAnswers, totalQuestions) {
      const percentage = (correctAnswers / totalQuestions) * 100;

      if (percentage >= 90) {
        return `Score: ${percentage.toFixed(0)}% (⌐■_■) Web Master!`;
      } else if (percentage >= 70) {
        return `Score: ${percentage.toFixed(0)}% (•‿•) Great Job!`;
      } else if (percentage >= 50) {
        return `Score: ${percentage.toFixed(0)}% (•_•) Solid Effort!`;
      } else if (percentage >= 30) {
        return `Score: ${percentage.toFixed(0)}% (o_O) Needs Review.`;
      } else {
        return `Score: ${percentage.toFixed(0)}% (╥_╥) Keep Studying.`;
      }
    }

    function endQuiz() {
      quizStart = false;
      questionScreen.remove();  
      quizContainer.appendChild(quizEndScreen);
      quizEndScreen.querySelector(".final-score").textContent = getQuizResult(score, questions.length)
      clearInterval(timerId)
    }

    function isSelectedOptionCorrect() {
      const selection = ['a', 'b', 'c', 'd'][selectedOption]
      return selection === questions[currentQuestion].correct
    }

    function startQuiz() {
      quizStart = true;
      welcomeScreen.remove();
      quizContainer.append(questionScreen);
      updateQuestionScreen();
      startTimer();
    }

    function restartQuiz() {
      score = 0;
      selectedOption = -1;
      currentQuestion = 0
      quizTimeRemaining = quizTime
      dipsLeft = 2
      curLifeline = null
      nextButton.textContent = "Next"
      timer.textContent = `${quizTime}s`
      timerProgress.style.background = `linear-gradient(90deg, #DDB25C 100%, transparent 100%)`;
      Array.from(lifelineContainer.children).forEach(c => c.disabled = false) 
      lifelinesArray.forEach(l => l.used = false)
      quizEndScreen.remove()
      quizContainer.append(welcomeScreen)
    }

    function updateQuestionScreen() {
      const qs = questions[currentQuestion];
      question.textContent = qs.question;
      options.querySelectorAll(".option-wrapper").forEach((ow, index) => {
        ow.classList.remove("selected")
        ow.classList.remove("hidden")
        ow.classList.remove("wrong")
        ow.firstElementChild.disabled = false;
        ow.lastElementChild.textContent = qs[['a', 'b', 'c', 'd'][index]]
        ow.firstElementChild.checked = false;
      })
      progressBar.value = currentQuestion;
      scoreSpan.textContent = score
      qsNoSpan.textContent = currentQuestion + 1
      nextButton.disabled = true;
      if (currentQuestion === questions.length - 1) {
        nextButton.textContent = "Finish"
      }
    }

    function startTimer() {
      timerId = setInterval(tick, 1000)
      function tick() {
        playTick();
        quizTimeRemaining--; 
        if (quizTimeRemaining === 0) {
          endQuiz()
        } else  {
          timer.textContent = `${quizTimeRemaining}`
          const percentLeft = (quizTimeRemaining/quizTime)*100
          timerProgress.style.background = `linear-gradient(90deg, #DDB25C ${percentLeft}%, transparent ${percentLeft}%)`;
        }
      }
    }

    function handleLifeline(name) {
      if (curLifeline) {
        return;
      }
      curLifeline = lifelinesArray.find(o => o.name === name);
      if (curLifeline.used) {
        curLifeline = null;
        return;
      }

      curLifeline.used = true;
      curLifeline.handler()
    }

    function handleFiftyFifty() {
      const qs = questions[currentQuestion];
      const incorrect = ['a', 'b', 'c', 'd'].reduce((agg, option, idx) => {
        if (option !== qs.correct) {
          agg.push(idx)
        }
        return agg
      }, [])

      const index1 = Math.floor(Math.random() * 3);
      let index2 = Math.floor(Math.random() * 3);

      while(index1 === index2) {
        index2 = Math.floor(Math.random() * 3);
      }

      for(let i = 0; i < 4; i++) {
        const o = options.children[i]
        o.firstElementChild.checked = false;
        o.classList.remove("selected")
      }
      
      nextButton.disabled = true;
      const o1 = options.children[incorrect[index1]]
      o1.classList.add("hidden")
      o1.disabled = true;
      const o2 = options.children[incorrect[index2]]
      o2.classList.add("hidden")
      o2.disabled = true
      fiftyFifty.disabled = true
      curLifeline = null;
    }

    let dipsLeft = 2;
    function handleDoubleDip() {
      doubleDip.disabled = true;
      if (!fiftyFifty.disabled)
        fiftyFifty.classList.add("hidden");
    }

  </script>
</html>
